# Метаанализ

https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3083073/

https://www.google.com/search?q=Designing+clinical+research&sxsrf=AOaemvKJpgFS_eG6kQKAEmPQvMIDkh_7vA:1643268646973&ei=JkryYYnVOqOrrgSF3r-YCQ&start=0&sa=N&ved=2ahUKEwiJgOTftNH1AhWjlYsKHQXvD5M4ChDy0wN6BAgBED4&biw=1920&bih=936&dpr=1

https://www.google.com/search?q=Cummings%2C+Steven+R%2C+Warren+S+Browner%2C+and+Stephen+B+Hulley.+2013.+%E2%80%9CConceiving+the+Research+Question+and+Developing+the+Study+Plan.%E2%80%9D+Designing+Clinical+Research+4%3A+14%E2%80%9322.&sourceid=chrome&ie=UTF-8

## Что такое метаанализ и для чего он нужен?

Число научных публикаций растет в геометричекой прогрессии ежегодно. Исследователи со всех уголков земного шара пытаются проверить свои гипотезы. Несколько хорошо спланированных исследований принесут больше пользы в пллане понимания проверяенмых гипотез, чем одно большое и неважно спланированное, лишь для того, чтобы включить много пациентов. Проверяя гипотезы в разных популяциях мы получаем бесценные данные о том, что а) эффект прослеживается у разных групп (или, наоборот, есть только в конкретных группах) б) получаем информацию о вариабельности эффекта. Большое количество сходных исследований, по сути, являются репликациями одного большого эксперимента. Соответствено, большее количество репликаций повышает мощность и степень доверия к результатам.

Существуют несколько основных инструментов суждения о совокупных результатах неких единообразных исследований:

- **Систематические обзоры**. Систематические обзоры включают все исследования, которые возможно найти, соответствующие неким строгим критериям включения. Данные критерии включения направлены на соблюдение ряда стандартов, предъявляемых к планированию исследований, проведению и стандартным операционным процедурам и результатам (например, исследования по артериальной гипертензии, где артериальное давление оценивалось в соответствии с международными рекомендациями по кардиологии; исследования определенной манипуляции в хирургии, которая выполнялась строго в соответствии с четкими рекомендациями международных ассоциаций). 

- **Метаанализы**. Главным отличием метаанализа от систематических обзоров является не только рассмотрение результатов ряда исследований, но и попытка количественной оценки их результатов. В самом деле, нам необходимо знать не только то, что препарат/вмешательство обладает эффектом, но и оценить размер этого эффекта, и широту его вариабельности.

```mermaid
flowchart TD
    A[Вопрос исследования] --> B[Формирование критериев включения];
    B[Формирование критериев включения] --> C[Качественная оценка результатов исследований];
    B[Формирование критериев включения] --> D[Количественная оценка результатов исследований];
    C[Качественная оценка результатов исследований] --> E[Систематический\nобзор];
    D[Количественная оценка результатов исследований]--> F[Метаанализ ];
```
![](https://mermaid.ink/img/pako:eNq1UstKw0AU_ZVh1u0PRBDU1B_QXcbFkExsIQ-JE0RKIamgG7HgUtwIfkAshtbWxl-480eeSVvcuNMODDNz7rnnnnuZIffTQHGHh1F65fdlptmpKxKGdeDRIzX0ZQpqTMlobkpT0pJqegc8pYpWwCZnrNvdZ4cevYJW0Cew4idONaMFgLkZU21PpE8Zogtamgdzh-daZW9d9M86rZsjj56osig8j8Gy0RWQCYP4bftcUMUgVNPM3EDjHrwKu7Gyv7ZKH_9r0rUmG1SZ78zorubQ-u959NIy0CwmYZM2nUATLCESJL3RzI5q62iXTVtTxx49QxfsFq5sJZoxW553eKyyWA4CfPehtSO47qtYCe7gGqhQ5pEWXCQjUPOLQGrVCwY6zbgTyuhSdbjMdXpynfjc0VmutiR3IM8zGW9Yo2_3uwd8)

## Основной вопрос исследователя

Как мы с вами [уже говорили](/docs/pages/stat_testing/stat_testing.md), любое исследование/эксперимент начинается с постановки вопроса. Метаанализ позволяет ответить на вопросы, на которые уже пытались ответить в проведенных исследованиях. Чем точнее и конкретнее исследователи ставят вопрос, тем яснее становится, можно ли на него ответить с помощью метаанализа и какие исследования подходят для этого.  

Например, мы можем поставить вопрос о том, существует ли возрастные смещения среди пациентов, перенесших острый ишемический инсульт в старческом возрасте. Для начала , определим, что такое старческий возраст.  Мы провели литпоиск и поняли, что *старческий возраст* - это возраст 75 лет и старше (например). Далее нам нужжно определить генеральную совокупность. Целесообразно привязать наш вопрос к некоей георграфической области, например, Владимирская область. Либо сузить критерии по-другому, например, брать исследования только в крупных мегаполисах России (или , наоборот, в малых городах). Всё зависит от того, что на самом деле мы хотим исследовать. 

Как только нам стало несколько яснее с вопросом исследования, мы начинаем вырабатывать **критерии включения**. Существуют т.н. критерии PICO [^Mattos] (Population, Intervention, Control group/comparison, Outcome), позволяющие сформулировать критерии включения:

- Популяция. Какие пациенты подойдут для ответов на наши вопросы, а какие - нет? Начать можно с банальной демографии (пол, возрастные группы и т.д.), заканчивая вопросами анамнеза (пациенты с установленным кардиостимулятором по поводу синдрома тахи-бради в течение последних 6 месяцев и т.д.). Могут ли быть использованы данные пациентов, коорые самостоятельно заполнили опросники исслдования, либо нужно включать только исследования, где всю документацию заполнил лечащий врач? Или это долженбыть врач-исследователь (ведь лечащий врач может направить более тяжелого пациента в исследование, т.к. хочет дать ему шанс, что приведет к потенциальному *selection bias*)? 

- Вмешательство. Какое вмешательство будет выполнено (терапевтическое, хирургическое, без вмешательства и т.д.)? Если это хирургическое вмешательство/манипуляция, по каким стандартам оно должно быть выполнено? как оценивался эффект вмешательства (оценка уровня гемоглобина на фоне резекции селезенки, осложненном кровотечением: в одних исследованиях анализ крови брали сразу после завершения операции, в других - на первые сутки)? Сопоставимо ли было оборудование при проведении вмешательства (например, оценка некоторых УЗ-параметров может сильно отличаться у разных производителей, у одного производителя на аппарате экспетрного класса и портативном аппарате)?

- Контрольная группа и группа сравнения. Принципиально ли наличие контрольной группы? Будет ли в этой группе проведена терапия *плацебо*, либо это будет *активный компаратор*? Как в исследовании учитывался прием/неприме препарата? Какой принцип анализа проводился - Intention-To-Treat, Per Protocol или As Treated?

- Конечная точка. Какая конечная точка использована в исследованиях (мягкая, жесткая, комбинированная и т.д.)? Одинаковы ли конечные точки по всем исследованиям, , если нет, принципально ли рассмотерть их, как единую? Как оценивался размер эффекта по разным исследованиям? Возможно ли рассчитать стандартизованный размер эффекта для разных исследований? Когда оценивалась конечная точка (в онкологических исследованиях отдаленная летальность может быть оценена на сроке 3,5 7 и 10 лет - это принципиально разные конечные точки). 

Также важным аспектом является выбор типа исследований для включения в метаанализ. Безусловно, самым высоким стандартом являются рандомизированные клинические исследования (РКИ) с прозрачным и качественным протоколом. Однако, есть ситуации, когда РКИ еще не проведены или не будут проведены по этическим причинам. В таких ситуациях целесообразно рассмотретьпилотные или качественные обсервационные исследования. Меньшей доказательной ценностью обладает, как считается, так называемая *серая литература (grey literature)*: коммерческие отчеты о клинических исследованиях, препринты, тезисы конференций, а также диссертационные работы [^Schöpfel]. 

## Избранные рекомендации

Существует большое количество рекомендаций о том, как писать метаанализ, проводить поиск, предоставлять данные. Ниже приведены ссылки на некоторые из них:

- Cochrane Handbook for Systematic Reviews of Interventions [^Cochrane];

- Preferred Reporting Items for Systematic Reviews and Meta-Analyses (PRISMA) [^PRISMA];

- American Psychological Association’s Meta-Analysis Reporting Standards (MARS) [^MARS];

Если вы планируете проделать метаанализ, данные рекомендации - минимум, от корого нужно оттолкнуться. Настоящий же обзор сфокусирован на прикладных техниках проведения метаанализа. 

## Протокол метаанализа

Весь ход нашей работы логично документировать в протоколе, содержащим традиционные разделы о цели, задачах, критериях включения/невключения, диаграммы дазайна (общепринятые диаграммы имеются на сайте [PRISMA](http://prisma-statement.org/PRISMAStatement/FlowDiagram)), описание материалов и методов, результатов и выводов. 


**Типичная диаграмма дизайна метаанализа**
![](https://www.researchgate.net/profile/Giuseppe-Giugliano/publication/265862848/figure/fig1/AS:688936917680128@1541266769162/Meta-Analysis-Flow-Chart-Flow-diagram-demonstrating-study-selection-for-meta-analysis.png)

---

# Размеры эффекта

## Что такое размер эффекта?

Мы уже касались понятия размера эффекта [в статье о тестировании статистичеких гипотез](/docs/pages/stat_testing/stat_testing.md).

Напомню, что размер эффекта обозначает некую статистику или показатель, показывающий величину различий или ассоциации между распределениями. Наличие эффект и его размер - то, что мы пытаемся оценить для того, чтобы сделать статистический вывод о том, возможно ли отвергнуть нулевую гипотезу. 

В силу того, что методы проведения разных исследований отличаются по тем или иным причинам (например, есть различия между базовыми характеристиками пациентов или по оценке конечной точки с помощью разных шкал или единиц измерения и т.д.), возникает вопрос о приведении результатов исследований к некоему единому виду. часто это возможно сделать с помощью оценки размеров эффекта. В некоторых исследованиях размер эффекта приводится напрямую, в других же его приходится вычислять. 

При выборе подходящей оценки размера эффекта необходимо помнить, что требуемая метрика должна соответствовать нескольким практическим критериям:

- размер эффекта банально *возможно* оценить по результатам всех включенных исследований;

- размер эффекта должна *одинаково рассчитываться* по результатам всех исследований;

- размер эффекта подчиняется некоему теоретическому распределению, что позволяет рассчитать стандартную ошибку и взвешенный эффект;

- определение размера эффекта должно позволить ответить на вопрос исследования, т.е., размер эффекта должен быть *интерпретируемым*;

Размер эффекта имеет *выраженность и направление*. Выраженность и характеризует тот самый *размер*, а направление показывает куда изменение направлено. Например, коэффициент корреляции по Пирсону $r = -0.8$ означает сильную ассоциацию между переменными (выраженность), но при этом такая ассоциация обратная - чем выше одна величина, тем ниже другая (направление эффекта). 

*Истинный размер эффекта* исследования k $\theta_k$ складывается из *наблюдаемого в исследовании размера эффекта* $\hat{\theta_k}$ в исследовании и ошибки выборки $\epsilon_k$:

$$
\theta_k = \hat{\theta_k} + \epsilon_k
$$

Соответственно, мы  считаем, что среди нескольких исследований наиболее точными являются те, где $\epsilon$ наименьшая. таким исследованиям в метаанализе придается больший *вес*. Оценка $\epsilon$ производится с помощью *стандартной ошибки*, которая представляет собой стандартное отклонение выборочного распределения. Выборочное распределение является вероятностным распределением некоей статистики, когда мы выбираем случайные выборки одинакового размера $n$ из генеральной совокупности большое количество раз. 

Приведем пример. Существует генеральная совокупность с неким показателем $x$, имеющим нормальное распределение со средним значением в генеральной совокупности (истинная средняя) $M$ и стандартным отклонением в генеральной совокупности (истинное стандартное отклонение) $\sigma$.
Если мы возьмем из генеральной совокупности выборку длиной $n$, среднее значение выборки $\mu_k$ будет отличаться от $M$ на величину некоей ошибки. Если мы снова возьмем выборку длиной $n$, среднее новой выборки $\mu_{k+1}$ также будет отличаться от $M$, но ошибка будет несколько другой. 

Стандартная ошибка (*SE*) отражает отклонение точечной оценки (например, среднего значения) в выборке от истинного значения параметра в генеральной совокупности. Стандартная ошибка вычисляется по формуле

$$
SE = \frac{\sigma}{\sqrt{n}},
$$

где $\sigma$ - истинное стандартное отклонение в генеральной совокупности, $n$ - длина выборки. Соответственно, чем больше размер выборки $n$, тем меньше отклонение от среднего в генеральной совокупности, и тем меньше стандартная ошибка.

Рассмотрим пример на основании генеральной совокупности, где средняя равна 0, а стандартное отклонение 3. Создадим 500 случайных выборок длиной от 1 до 500 и рассчитаем для каждой выборочное среднее и стандартную ошибку. Результат представлен на графиках ниже. 

**Среднее значение выборки в зависимости от ее размера (средняя генеральной совокупности равна 0)**
![](https://raw.githubusercontent.com/aysuvorov/clinstats/master/docs/pages/metaanalysis/images/sample_mean.png)

**Стандартная ошибка в зависимости от размера выборки для верхнего графика**
![](https://raw.githubusercontent.com/aysuvorov/clinstats/master/docs/pages/metaanalysis/images/standard_error.png)

Таким образом, мы видим, что с увеличением объема выборки $n$ выборочное среднее $\mu$ стремится к среднему генеральной совокупности $M$ (к значению 0 на графике), а стандартная ошибка $SE$ при увеличении длины выборки снижается и стремится к 0. 

### Как оценивается размер эффекта?

Огромный вклад в концепцию размера эффекта внес психолог и статистик Jacob Cohen. Сегодня существует большое количество статистик, позволяющих оценить размер эффекта, фактически при проверке любых гипотез.

Выделяют стандартизованные методы оценки размера эффекта и нестандартизованные. Стандартизованные способы позволяют оценивать эффект для переменных с разной размерностью (например, оценка коэффициента корреляции для переменных, измеряемых в разных единицах), для оценки совокупных результатов  разных исследований (мета анализ и мета регрессия), при сравнении результатов исследований с использованием разных метрик переменных (например, при использовании г/л в одном исследовании и ммоль/л в другом). 

Рассмотрим основные способы оценки размера эффекта и вычисления стандартной ошибки для вещественных признаков и признаков, представленных бинарными переменными. 

#### Вещественные признаки

**Таблица 1. Избранные методы оценки размера эффекта, оценивающие вещественные признаки**

| Название                                               | Описание                                                     | Стандартизованный метод | Размер эффекта $\theta$                    | Стандартная ошибка $SE$                                      |
| ------------------------------------------------------ | ------------------------------------------------------------ | ----------------------- | ------------------------------------------ | ------------------------------------------------------------ |
| Среднее                                                | Среднее значение                                             | Нет                     | $\mu$                                      | $SE = \frac{sd}{\sqrt{n}}$                                   |
| Дельта средних                                         | Дельта между 2-мя средними                                   | Нет                     | $MD = \mu_1 - \mu_2$                       | $SE = s_{pooled}^* \times \sqrt{\frac{1}{n_1}+\frac{1}{n_2}}$ |
| Стандартизованная дельта средних                       | Разница между 2-мя средними, отнесенная ко взвешенному стандартному отклонению. | Да                      | $SMD = \frac{\mu_1 - \mu_2}{s^*_{pooled}}$ | $SE = \sqrt{\frac{n_1 + n_2}{n_1 n_2} + \frac{SMD^2}{2(n_1 + n_2)}}$ |
| Дельта средних с парными измерениями                   | Разница между 2-мя средними после вмешательства и до вмешательства | Нет                     | $MD = \mu_{t2} - \mu_{t1}$                 | $SE = \sqrt{\frac{s^2_{t2} + s^2_{t1} - 2(r_{t1t2}s_{t2}s_{t1})}{n}}$ |
| Стандартизованная дельта средних с парными измерениями | Стандартизованная разница между 2-мя средними после вмешательства и до вмешательства | Да                      | $SMD = \frac{\mu_{t2} - \mu_{t1}}{s_{t1}}$ | $SE = \sqrt{\frac{2(1-r_{t1t2})}{n} + \frac{SMD}{2n}}$       |

Для некоторых статистик используется взвешенное стандартное отклонение. Рассчитать его возможно по формуле:

$$
s_{pooled} = \sqrt{\frac{(n_1 - 1)s^2_1 + (n_2 - 1)s^2_2}{(n_1 - 1) + (n_2 - 1)}}
$$

#### Для чего нужны стандартизованные показатели?

Предположим, у нас есть 2 исследования по снижению систолического артериального давления (САД). Мы даем пациентам один и тот же препарат, однако в 1 исследовании пациенты с преимущественно мягкой гипертензией, в исследовании 2 - пациенты с тяжелой артериальной гипертензией. Более того, в исследованиях разное количество пациентов. Основные статистики для обоих иследований приведены в табл.Х.

|                | Количество пациентов | Среднее значение САД и стандартное отклонение на включении | Среднее значение САД и стандартное отклонение при завершении исследования | Дельта средних MD [95% ДИ]| Стандартизованная дельта средних с парными измерениями [95% ДИ]   |
| -------------- | -------------------- | ---------------------------------------------------------- | ------------------------------------------------------------ | -------------- | ----- |
| Исследование 1 | 56                   | 154 ± 13 мм рт. ст.                                        | 131 ± 17 мм рт. ст.                                          | - 23 [-25.1;-20.9]          | -1.77 [-1.86; -1.67] |
| Исследование 2 | 34                   | 187 ± 25 мм рт. ст.                                        | 160 ± 26 мм рт. ст.                                          | -27 [-31.4; -22.6]           | -1.08 [-1.31; -0.84]|

Мы видим, что на включении группы различаются как по средним значениям, так и по стандартным отклонениям. Из-за того, что группа в исследовании 2 меньше, стандартное отклонение там несколько больше, что логично. 

Если мы оценим банальную разницу средних (MD), мы увидим, что снижение САД в абсолютном значении чуть больше снизилось в исследовании 2. Однако, если мы посчитаем стандартизованные средние для исследований с парными измерениями, мы увидим, что в исследовании 1 стандартизованная средняя почти в 2 раза выше, чем в исследовании 2. 

Таким образом, если опираться на стандартизованные значения размера эффекта, среди пациентов исследования 1 снижение САД было более выраженным, чем среди  пациентов с тяжелой гипертензией в исследовании 2. 

Другая ситуация может быть связана с разными размерностями переменных. Например, при исследовании обезболивающего препарата в одном исследовании использовалась визуальная аналоговая шкала боли от 0 до 10, а в другом от 0 до 50. Сравнить эффект по разным шкалам нам снова поможет стандартизованный показатель:

|                | Количество пациентов | Срадний балл ВАШ на включении | Срадний балл ВАШ при завершении исследования | Дельта средних MD [95% ДИ] | Стандартизованная дельта средних с парными измерениями [95% ДИ] |
| -------------- | -------------------- | ----------------------------- | -------------------------------------------- | -------------------------- | ------------------------------------------------------------ |
| Исследование 1 | 58                   | 8 ± 2                         | 2 ± 2                                        | - 6 [-6.26; -5.74]         | -3 [-3.42; -2.58]                                            |
| Исследование 2 | 82                   | 40 ± 10                       | 26 ± 16                                      | -14 [-15.5; -12.4]         | -1.4 [-1.52; -1.28]                                          |

#### Бинарные признаки

Перед расчетом размера эффекта для бинарных признаков необходимо вспомнить т.н. четырехпольную таблицу, связанную с простым дизайном исследований с 2-мя группами и развитием некоего эффекта в каждой из них:

|             | Эффект | Без эффекта | Итог             |
| ----------- | -------- | ------- | ----------------- |
| **Вмешательство** | $a$ | $b$ | $n_t$ |
| **Без вмешательства** | $c$ | $d$ | $n_c$ |
| **Итог** | $n_E$ | $n_F$ |  |


**Таблица 2. Избранные методы оценки размера эффекта, оценивающие бинарные признаки**

| Название                         | Описание                                                     | Размер эффекта $\theta$                       | Стандартная ошибка $SE$                                      |
| -------------------------------- | ------------------------------------------------------------ | --------------------------------------------- | ------------------------------------------------------------ |
| Пропорция                        | Отношение количество элементов $k$ в группе размером $n$ к $n$ | $p = \frac{k}{n}$                             | $SE = \sqrt{\frac{p(1-p)}{n}}$                               |
| Лог-трансформированная пропорция | Позволяет оценить *шанс*                                     | $p_{logit} = log_e(\frac{p}{1-p})$            | $SE = \sqrt{\frac{1}{np} + \frac{1}{n(1-p)}}$                |
| Отношение шансов                 | $Odd_t = \frac{a}{b}; Odd_c = \frac{c}{d}$                   | $OR = \frac{a/b}{c/d}; logOR = log_e(OR)$     | $SE_{logOR} = \sqrt{\frac{1}{a} + \frac{1}{b} + \frac{1}{c} + \frac{1}{d}}$ |
| Относительный риск               |                                                              | $RR = \frac{a/n_t}{c/n_c}; logRR = log_e(RR)$ | $$SE_{logRR} = \sqrt{\frac{1}{a} + \frac{1}{c} - \frac{1}{a+b} - \frac{1}{c+d}}$$ |

**Относительный риск** представляет собой отношение 2-х пропорций развития эффекта. В группе "Вмешательство" в 4-хпольной таблице доля эффекта составит $p_{tE} = \frac{a}{n_t}$, в группе "Без вмешательства": $p_{cE} = \frac{c}{n_c}$. Группа, относительно которой рассчитывается риск, называется *референсной*, а группа, для которой рассчитывается риск, называется *основной*. Если пациент попадает в группу "Вмешательство", а референсной является группа "Без вмешательства", относительный риск развития эффекта у пациента составит $RR = \frac{p_{tE}}{p_{cE}}$. В обратной ситуации, когда референсной является группа "Вмешательство", а пациент в группе "Без вмешательства", относительный риск развития эффекта у пациента составит $RR = \frac{p_{cE}}{p_{tE}}$. Относительный риск **всегда** оценивается в отношении референсной группы, $RR = 1$ означает, что риск нахождения в основная группе равен риску нахождения в референсной группе.

Относительный риск распределен ненормально, поэтому в метаанализах часто используют лог-преобразование для RR и рассчитывают SE для статистики после такого преобразования. Лог-преобразование позволяет приблизить распределение к нормальному. 

**Шанс** показывает отношение вероятности получить эффект к вероятности не получить его. Например, шанс получить эффект, находясь в группе вмешательства, составит $Odd_t = \frac{a}{b}; Odd_c = \frac{c}{d}$. Говоря о шансах, мы подразумеваем **"шанс к 1"**. Если $Odd = 2$, значит имеется вероятность 2 к 1 получить эффект. 

Аналогично относительному риску, для расчета отношения шансов нужна основная группа и референсная группа. Также для отношения шансов справедливо требование по лог-трансформации для использования в метаанализе.

В результатах метаанализа предпочитают либо использовать RR, либо переводить OR в RR с помощью формулы

$$
RR = \frac{OR}{(1 - \frac{c}{n_c}) + (OR \times \frac{c}{n_c})}
$$

# Создание взвешенных показателей

## Краткая концепция статистической модели в метаанализе

Любой исследовательский вопрос связан с поиском ответа, как на самом деле происходят те процессы, которые мы наблюдаем. Другими словами, мы *моделируем* те или иные процессы для того, чтобы понять, как они происходят. Моделирование наблюдаемых явлений, в некотором роде, сводится к поиску математических уравнений, хорошо описывающих наблюдаемые данные. 

Построенные модели позволяют моделировать эффекты, выяснять их размер и даже прогнозировать их в зависимости от исходных данных. 

```mermaid
flowchart LR
    F[Вопрос\nисследователя] --> A[Сбор\nданных];
    A[Сбор\nданных] --> R[Наблюдаемые\nданные];
    R[Наблюдаемые\nданные] --> B{Математическое\nмоделирование};
    B{Математическое\nмоделирование} --> C[Оценка размера эффекта\nв данном эксперименте];
```
![](https://mermaid.ink/svg/pako:eNqlkc1Kw0AUhV9lmHX7AhEEf1eu6jLTxdBMbSA_EieIlEBTqi6KCq5V8A3SksHQpu0r3PtG3kzbhQtBMJu55Hzn5J7JkPdiT3GH94P4tjeQiWYXHRExes5deIU1bHAEa8yFiKDCHHNYgoGShDkUOKZ5iS9d1m4fsiMXPmFG8KiBSyhgBSuc4n33YJv4O2D9HRfe6d2MEp-taqDGKZgfMJh92l9xm308hLfdvrU9K3wEQ20W1MRaahrKpg5Jo209iqjAZLvv_SfC7nDiwgc-kL4iS8EIKeCLTKaZGD7hBCekLii6aOLmbN-DsmoCSMphY_mq8VHB8fY-eIuHKgml79GvHDb7Cq4HKlSCOzR6qi_TQAsuoozQ9NqTWp15vo4T7vRlcKNaXKY6vryLetzRSar20KkvrxIZ7qjsG5CjPMg)

Моделирование в метаанализе подразумевает, что объединяя несколько исследований, мы предполагаем, что наблюдаемые в исследованиях эффекты разнятся от исследования к исследованию, однако существует некий общий истинный эффект определенного размера. Метааналитические модели позволяют с отй или иной точностью оценить размер этого эффекта, а также объяснить причину наблюдаемых различий в результатах исследований. 

Принципиально в метаанализах используются 2 типа моделей:

- модели с **фиксированными эффектами**,
- модели со **случайными эффектами**.

### Модели с фиксированными эффектами

Модели с фиксированными эффектами предполагают, что размеры эффекта во всех выбранных исследованиях исходят из одной гомогенной генеральной совокупности. Т.е., существует некий истинный эффект $\theta$, а наблюдаемые размеры эффекта в исследованиях $\hat{\theta_k}$ различаются только в силу ошибки выборки $\epsilon_k$:

$$
\hat{\theta_k} = \theta + \epsilon_k
$$

Сами же исследования рассматриваются, как довольно гомогенные репликации одного и того же эксперимента, это является очень важным допущением данной модели. Таким образом, мы предполагаем, что *можно пренебречь различиями* групп пациентов в исследованиях, качеством помощи в центрах проведения исследований, различиями в проведении вмешательств и т.д. Мы помним, что ошибка выборки оценивается с помощью стандартной ошибки.

Графически мы увидим, что существует некий истинный размер эффекта (красная линия), вокруг которого располагаются результаты разных исследований (представлены точками на графике). Исследования с маленькой стандартной ошибкой плотно располагаются вокруг прямой истинного размера эффекта, исследования с большей стандартной ошибкой сильнее отклоняются от красной прямой. 

![](https://raw.githubusercontent.com/aysuvorov/clinstats/master/docs/pages/metaanalysis/images/fixed_eff.png)

Соответственно, мы понимаем, что в метаанализе наиболее близки к истинному эффекту исследования с низкой стандартной ошибкой. Для того, чтобы более точно оценить приблизительный истинный эффект, мы должны придать исследованиям веса так, чтобы исследования с низкой SE имели больший вес, а исследования с высокой SE - низкий вес. Довольно простым способом такого расчета является метод обратной дисперсии - вес исследования равен отношению 1 к величине дисперсии как квадрата стандартной ошибки:

$$
w_k = \frac{1}{s^2_k}
$$

Для того, чтобы оценить взвешенный размер эффекта $\hat{\theta}$, нам нужно банально рассчитать взвешенное среднее эффектов всех $N$ исследований в метаанализе:

$$
\hat{\theta} = \frac{w_1\hat{\theta}_1 + w_2\hat{\theta}_2 + ... + w_N\hat{\theta}_N}{w_1 + w_2 + ... + w_N}
$$

Такой метод получил название взвешивание по обратной дисперсии (inverse-variance weighting).

### Модели со случайными эффектами

В реальности мысль о том, что ряд исследований, проведенных в разные годы, в разных странах, в центрах с разными стандартами оказания медицинской помощи представляется несколько нелогичной. Для оценки эффекта могут использоваться сходные до определенного уровня, но все же довольно разные способы. 

Таким образом, различия наблюдаемых эффектов в исследованиях могут быть вызваны целым рядом причин, а не банальной ошибкой выборки. Иными словами, сы признаем наличие других источников вариабельности. Мы больше не считаем индивидуальные исследования исходящими из единой гомогенной совокупности, а думаем, что они исходят из большого количества различных совокупностей. 

Модель со случайными эффектами предполагает, что не существует одного истинного эффекта для группы исследований в метаанализе, но в каждом исследовании имеется свой истинный эффект, и множество этих истинных эффектов имеют распределении. Оценка математического ожидания или среднего такого распределения и есть основная идея моделирования со случайными эффектами. 

Если представить, что для каждого исследования в метаанализе существует свой истинный эффект $\theta_k$, наблюдаемый эффект в исследовании будет складываться из истинного эффекта и ошибки выборки:

$$
\hat{\theta}_k = \theta_k + \epsilon_k
$$

Однако, как мы решили, истинный эффект в каждом исследовании представляет собой среднее всех истинных эффектов $\mu$ и некоего дополнительного источника ошибок (или *гетерогенности*) $\xi_k$ - различные когорты пациентов, разная техника выполнения маниипуляций и т.д. 

$$
\theta_k = \mu + \xi_k
$$

Таким образом, единое уравнение модели со случайными эффектами выглядит следующим образом:

$$
\hat{\theta}_k = \mu + \xi_k + \epsilon_k
$$

Принцип расчета весов для модели со случайными эффектами аналогичен модели с фиксированными эффектами, однако нам нужно учитывать, что теперь у нас есть множество истинных эффектов, распределение которых имеет дисперсию $\tau^2$. Эта дисперсия отражает гетерогенность между исследованиями. 

Таким образом, уравнение для расчета весов выглядит следующим образом:

$$
w^*_k = \frac{1}{s^2_k + \tau^2}
$$

Из нее вытекает формула оценки взвешенного эффекта:

$$
\hat{\theta} = \frac{w^*_1\hat{\theta}_1 + w^*_2\hat{\theta}_2 + ... + w^*_N\hat{\theta}_N}{w^*_1 + w^*_2 + ... + w^*_N}
$$

Для оценки самой $\tau^2$ существует ряд популярных методов: DerSimonian-Laird, Restricted Maximum Likelihood, Paule-Mandel и ряд других. [^DerSimonian], [^Viechtbauer], [^Paule]  

### Какую модель лучше использовать?

При анализе клинических исследований в медицине наиболее часто используются модели со случайными эффектами. При проведении классичекого метаанализа существует обычно довольно высокая гетерогенность между исследованиями, которую нельзя игнорировать. 

В медицине и социальных науках модели с фиксированными эффектами имеют довольно ограничекснное применение. Например, при проведении многоцентрового клинического исследования возможно оценить некий единый эффект, рассматривая центры, как фиксированные эффекты. 

Крупные исследования, проведенные несколько по-разному и в разные годы, объединенные в единый метаанализ, скорее имеют 

# Гетерогенность, способы ее оценки и интерпретация

## Что такое гетерогенность и в чем ее причины

Эффект в исследованиях, включенных в метаанализ, может различаться. Гетерогенность между исследованиями (between-study heterogenity) является показателем, оценивающим степень таких различий. 

Гетерогенность зависит от многих причин, наиболее частые из которых:

- неверный подбор исследований для метаанализа;
- наличие явеых и скрытых *факторов-модераторов*, влияющих на взвешенный эффект (модератор фактически создает подгруппы с разным размером эффекта);
- небольшое количество исследований в метаанализе.

Когда исследователи сталкиваются с избыточной гетерогенностью, например, в ситуации, где у ряда исследований противоположное направление эффекта, или когда крайне разный размер эффекта, необходимо разобраться, не имеет ли место ошибочное включение исследований в метаанализ. Попытка объединить исследования, в которых оценивались совершенно разные вещи, приведет к огромной гетерогенности и не ответит на вопрос метаанализа. Результаты такого метаанализа довольно крайне сомнительны. 

Если мы считаем, что на данном этапе ошибки нет, необходмимо далее искать причину высокой гетерогенности. Например, при использовании нестандартизованных показателей необходимо попытаться использовать стандартизованные. Ряд показателей может быть измерен в разных шкалах или значительно различаться на включении между исседованиями - стандартизация позволяет сгладить такие различия. 

Следующей причиной высокой гетерогенности является наличие скрытых или явных модераторов или конфаундеров. Например, при оценке распространенности сердечно-сосудистых заболеваний явными модераторами являются пол и возрастная группа пациентов. Включение модератора и оценка его влияния на эффект и гетерогенность проводится с помощью *метарегрессионного анализа или метарегрессии*. Дальнейших анализ подгрупп позволяет значительно снизить гетерогенность. 

Наконец, малое количество исследований в метаанализе может привести к высокой гетерогенности. 

По Rücker существует 2 основных типа гетерогенности: [^Rucker]

- **Гетерогенность, обусловленная дизайном или базовыми характеристиками**. Причниой является попытка объединить в метаанализе различные по дизайну исследования (включая тип исследования, характер вмешательства, способ оценки результатов, срок их оценки и т.д.), а также исследования, сильно гетерогенные по когортам пациентов. Данный тип гетерогенности может приводить к *статистической гетерогенности*;
- **Статистическая гетерогенность**. Обусловлена точностью оценки и вариабельностью размера эффекта. Данную гетерогенность уже можно оценить количественно. Одной из причин (но совсем не всегда) статистической гетерогенности может быть гетерогенность, обусловленная дизайном. 

## Способы оценки гетерогенности

### Cochran`s $Q$

Мы рассмотрели оба типа моделей и поняли, что существует наблюдаемый эффект $\hat{\theta}_k$ некоего исследования $k$, а также взвешенный эффект, который мы рассчитываем $\hat{\theta}$ для всех исследований метаанализа. Мы также помним, что у каждого исследования есть свой вес $w_k$. отклонение наблюдаемого эффекта от взвешенного может быть направлено в любую сторону (т.е., быть с любым знаком). Если мы возведем отклонение в квадрат, оно больше не будет привязано к направлению. 

Сумма взвешенных квадратов таких отклонений получило название Cochran’s $Q$:

$$
Q = w_1(\hat{\theta}_1 - \hat{\theta})^2 + w_2(\hat{\theta}_2 - \hat{\theta})^2 + \\
+ w_1(\hat{\theta}_1 - \hat{\theta})^2 + ... + w_n(\hat{\theta}_n - \hat{\theta})^2
$$

Мы можем рассчитать отклонение наблюдаемого эффекта от взвешенного по всем исследованиям.

Распределение Cochran’s $Q$ сильно приближено к распределению $\chi^2$ с $K-1$ степенями свободы, где $K$ - соличество исследований в метаанализе.

Cochran’s $Q$ будет расти при уведичении количества исследований в метаанализе, а также при наличии крупных исследований с большим количеством пациентов. 

### $I^2$ - статистика Хиггинса и Томпсона

Данная статистика рассчитывается с помощью Cochran’s $Q$ и указывает на % гетерогенности, обусловленный ошибкой $\xi_k$ (т.е., ошибкой, не связанной с размером выборки).

нудевая гипотеза состоит в том, что гетерогенность отсутствует, и Cochran’s $Q$ следует распределению $\chi^2$ с $K-1$ степенями свободы (ожидаемая гетерогенность). Но у нас имеется и наблюдаемая гетерогенность $Q$. Тогда отклонение наблюдаемой гетерогенности от ожидаемой составляет:

$$
I^2 = \frac{Q-(K-1)}{Q}
$$

и выражается в долях единицы или в процетах. 

Принято выделять низкую (до 25%), умеренную (25-75%) и высокую (75% и выше) гетерогенность [^Higgins].

### $H^2$ - статистика

Данная статистика расчитывает отношение $Q$-статистики к $K-1$: при отсутствии гетерогенности значение стремится к 1. Более высокие значения говорят о наличии гетерогенности между исследованиями.

$$
H^2 = \frac{Q}{(K-1)}
$$

### Дисперсия гетерогенности $\tau^2$

Как мы упоминали ранее, истинный эффект имеет дисперсию $\tau^2$ и стандартное отклонение $\tau$.

Данная статистика хорошо подходит для оценки меры гетерогенности, т.к. имеет ту же размерность, что и эффект в исследованиях в метаанализе. Зная рассчитанный взвешенный размер эффекта $\hat{\theta}$ в метаанализе, мы можем оценить 95% ДИ истинного эффекта, как $\hat{\theta} \pm 1,96 \times \tau$.

### GOSH - plots

Важным способом оценки гетерогенности и поиска возможных ее причин является т.н. GOSH-plot (graphical display of study heterogeneity, графическое отображение гетерогенности исследований) [^Olkin]. 

В основе построения данного графика лежит оценка эффектов и гетерогенности среди всех возможных комбинаций между исследованиями. После получения оценок для каждой комбинации создается оригинальный график:

![](https://raw.githubusercontent.com/aysuvorov/clinstats/master/docs/pages/metaanalysis/images/gosh.png)

По оси Х представлен размер эффекта, по оси Y - гетерогенность. Мы видим, что при размере эффекта 0-0,5 гетерогенность невелика. Также она невелика при большом размере эффекта, 2,3-3. Очевидно, что это вызвано тем, что есть группа исследований с большим, и группа с малым размерами эффекта, с крайними значениями. При соединении исследований с большим и малым размером эффекта в комбинацию гетерогенность резко возрастает ($I^2$ стремится к 100%), а взвешенный размер эффекта находится в пределах от примерно 0,5 до 2,3. Таким образом, мы можем предположить, что в метаанализ включены несколько разные группы исследований. 

## График Forest Plot и не только

Наиболее общим способом суммировать результаты метаанализа является т.н. **forest plot** - специфический график, отображающий исследования, вошедшие в анализ, эффект в каждом из них, ывзвешенный эффект, а также ряд дополнительных характеристи, например, веса каждого исследования, показатели гетерогенности, тип выбранной статистической модели (фиксированные или случайные эффекты). Неотъемлемой частью forest plot является диаграмма, дублирующая размеры эффекта и их 95% ДИ, а также взвешенный эффект. Довольно часто размер точек на графике, характеризующих определенное исследование, связан с весом данного исследования (соответственно, точки наибольшего размера связаны с исследованиями с наибольшим весом). 

Типичный forest plot показан на рисунке ниже. Данные исследования взяты из материалов, сопровождающих библиотеку `meta` языка программирования R [^Schwarzer], [^Fleiss].

![](https://raw.githubusercontent.com/aysuvorov/clinstats/master/docs/pages/metaanalysis/images/forest.png)

Мы видим названия исследований и год публикации результатов, характеристики основных и контрольных групп (количества, средние и стандартные отклонения - необходимые нам данные для расчета стандартной ошибки), размер эффекта (а данном случае, mean difference (MD)) и его 95% ДИ, веса в моделях с фиксированными и случайными эффектами, взвешенный эффект для обоих типов моделей, а также показатели гетерогенности. Также мы видим диаграмму с отрисовкой всё тех же размеров эффекта в исследованиях (в виде квадратиков) и взвешенные эффекты (в виде ромбов). 

Вертикальная сплошная черта обозначает размер эффекта, равный 0. Т.к. мы имеем дело с MD, если 95% ДИ отдельных исследований или взвешенных эффектов включает 0, значит эффекта в данном исследовании (или во всем метаанализе, если ромб включает 0) нет, а наблюдаемые эффекты случайны. 

В нашем же примере исследования, чей эффект не включает 0 в 95% ДИ единственное - исследование Florell 1971, его вес в модели со случайными эффектами наивысший и составляет ровно треть (33,3%). Мы видим, что взвешенный эффект в модели со случайными эффектами составил -0,75 [-1,53; 0.03]. Т.е., 95% ДИ взвешенного эффекта включает 0, следовательно, эффект в экспериментальной группе не отличается от эффекта в контрольной группе по результатам нашего метаанализа. 

### Drapery Plots

Другой интересной разновидностью предоставления результатов является график drapery plot. По оси Х на таком графике находится размер эффекта (в нашем случае - MD), по оси Y - р-value для размеров эффекта в каждом индивидуальном исследовании (серые линии распределений), а также для взвешенного эффекта (красная линия для модели со случайными эффектами). Затененная голубая область показывает, где могут лежать значения размера эффекта проведенных или новых исследований, при этом 

![](https://raw.githubusercontent.com/aysuvorov/clinstats/master/docs/pages/metaanalysis/images/drapery.png)

## Анализ подгрупп и мета-регрессия

Так или иначе, должна быть произведена попытка обосновать любую избыточную гетерогенность в метаанализе. Наиболее частой причиной различий размера эффекта в сходных исследованиях является наличие явного или скрытого *медиатора* - фактора, присутствие которого влияет на размер эффекта. 

Если информация о наличии / отсутствии такого фактора доступна, необходимо провести метарегрессионный анализ или анализ подгрупп. Наиболее часто в медицине потенциальным медиатором являются категориальные переменные. Таким образом, дальнейшая работа сводится к оценке влияния медиатора на эффект (проверка гипотезы о том, что влияние есть или отсутствует) и последующая оценка эффекта на разных уровнях медиатора (анализ подгрупп).

Медиатором могут быть один фактор или могут присутствовать несколько медиаторов, что происходит довольно редко, т.к. требует гигантской проделанной работы по литературному поиску. 

### Анализ подгрупп

При анализе подгрупп размер эффекта будет несколько меняться от подгруппы к подгруппе. таким образом, сложится ситуация, когда каждая подгруппа представляет собой, фактически, отдельный метаанализ. рассуждая подобным образом, мы понимаем, что при анализе подгрупп должна быть использована модель со случайными эффектами: каждая подгруппа представляет собой выборку из некоей совокупности, характеризующей эффект в подгруппе. Таким образом, число таких совокупностей, как минимум, совпадает с числом подгрупп (мы допускаем, что таких совокупностей бесконечно много. И если каждая подгруппа $k$ имеет некий взвешенный размер эффекта $\hat{\theta}_k$, от и гетерогенность в каждой подгруппе должна быть индивидуальной или $\hat{\tau}^2_k$. По предложению Borenstein [^Borenstein_2011] целесообразно рассчитывать взвешенную гетерогенность по всем подгруппам. 

Анализ подгрупп неизбежно приводит к проблеме множественных сравнений. Однако в общем случае проводить поправки на множественные сравнения и корректировать уровень значимости не рекомендуется [^Cochrane]. 

Во время планирования метаанализа необходимо предусмотреть наличие возможных медиаторов. Наиболее часто ими являются:

*зависящие от качества исследования*:

- тип проведенного исследования (РКИ, нерандомизированное сравнительное КИ, обсервационное и т.д.),
- размер выборки исследований,
- региональные особенности (страна, регион, исследовательский центр и т.д.);

*зависящие от исследуемой популяции*:

- пол,
- возрастные группы,
- сопутствующие заболевания, 
- семейный анамнез, 
- способ оценки эффекта и достижение КТ;

Это далеко не все кандидаты в потенциальные медиаторы. 

Минусы при проведении анализа подгрупп очевидны: 

- снижение мощности анализа,
- наличие потенциальных смещений при оценке размера эффектав подгруппах,
- затруднительный технический поиск при большом количестве исследований в метаанализе и большом количестве потенциальных подгрупп,
- потеря смысловой нагрузки проведения метаанализа при большом анализе подгрупп.

### Метарегрессия

Общий вид регрессионной модели представляет собой следующее уравнение:

$\hat{y}_i = \mu_0 + \beta x_i$

где $\hat{y}_i$ - некий результат для элемента (пациента, исследования и т.д.) $i$, $\mu_0$ - средний результат для всей выборки, $\beta$ - коэффициент, единый для всей выборки, умноженный на индивидуальный параметр элемента $i$. Таким образом, $\beta$ является фиксированным.

Уравнение метарегрессии выглядит сходно:

$\hat{\theta}_k = \theta_0 + \beta x_k + \epsilon_k + \gamma_k$

где $\epsilon_k$ представляет выборочную ошибку для исследования $k$, а $\gamma_k$ является ошибкой, не связанной с сэмплингом/выборкой. Таким образом, в уравнении присутствуют и фиксированные ($\beta$), и случайные эффекты ($\epsilon_k, \gamma_k$), что делает данную модель *смешанной моделью*. 

В настоящей публикации мы остановимся на метарегрессии с медиатором, являющимся бинарной переменной, например, пол или две возрастные группы. Переменная должна быть закодирована соответствующим образом в виде кодов 0 и 1, где 0 является референсной группой.

$C = \begin{cases} 0 = женщины, \\ 1 = мужчины. \end{cases}$

Вставляем наш медиатор в уравнение:

$\hat{\theta}_k = \theta_0 + \beta С + \epsilon_k + \gamma_k$

Если пол женский (референсная группа), эффект $\hat{\theta}_k$  определяется ошибками и $\theta_0$:

$
\hat{\theta}_k = \\ \theta_0 + \beta \times 0 + \epsilon_k + \gamma_k = \\ \theta_0 + \epsilon_k + \gamma_k
$

 Если пол мужской, C = 1, а значит уравнение приобретает вид:

$
\hat{\theta}_k = \\ \theta_0 + \beta \times 1 + \epsilon_k + \gamma_k = \\ \theta_0 + \beta + \epsilon_k + \gamma_k
$

Что же происходит? Если $\beta$ стремится к 0, то $0 \times C = 0$, а значит, для мужского пола и женского уравнения одинаковы. То есть, мужской пол не оказывает влияния на эффект. Если же $\beta$ велик, его влияние становится значимым, а наша задача - определить статистически, включает ли 95% ДИ для $\beta$ 0. Мы получаем диаграмму, которые рассматривали в публикации по сравнению статистических гипотез:

![](https://raw.githubusercontent.com/aysuvorov/clinstats/master/docs/pages/metaanalysis/images/effs.png)

Наша задача будет сводиться к тому, чтобы засечь статистически значимый размер эффекта. 

В модель может быть включено несколько потенциальных модераторов. Типичной задачей является поиск того модератора, которых является значимым и позволит провести анализ подгрупп и клиническое объяснение наблюдаемой высокой гетерогенности. 

## Публикационные смещения и подходы к их оценке





## Ссылки

[^Borenstein_2011]: Borenstein, Michael, Larry V Hedges, Julian PT Higgins, and Hannah R Rothstein. 2011. Introduction to Meta-Analysis. John Wiley & Sons.

[^Olkin]: Olkin I, Dahabreh IJ, Trikalinos TA. GOSH - a graphical display of study heterogeneity. Res Synth Methods. 2012;3(3):214-223. doi:10.1002/jrsm.1053

[^Higgins]: Higgins, Julian PT, and Simon G Thompson. 2002. “Quantifying Heterogeneity in a Meta-Analysis.” Statistics in Medicine 21 (11): 1539–58.

[^Rucker]: Rücker, Gerta, Guido Schwarzer, James R Carpenter, and Martin Schumacher. 2008. “Undue Reliance on I2 in Assessing Heterogeneity May Mislead.” BMC Medical Research Methodology 8 (1): 79.

[^Paule]: Paule, Robert C, and John Mandel. 1982. “Consensus Values and Weighting Factors.” Journal of Research of the National Bureau of Standards 87 (5): 377–85.

[^Viechtbauer]: Viechtbauer, Wolfgang. 2005. “Bias and Efficiency of Meta-Analytic Variance Estimators in the Random-Effects Model.” Journal of Educational and Behavioral Statistics 30 (3): 261–93.

[^DerSimonian]: DerSimonian, Rebecca, and Nan Laird. 1986. “Meta-Analysis in Clinical Trials.” Controlled Clinical Trials 7 (3): 177–88.

[^Mattos]: Mattos CT, Ruellas AC. Systematic review and meta-analysis: what are the implications in the clinical practice?. Dental Press J Orthod. 2015;20(1):17-19. doi:10.1590/2176-9451.20.1.017-019.ebo

[^Cochrane]: Higgins JPT, Thomas J, Chandler J, Cumpston M, Li T, Page MJ, Welch VA (editors). Cochrane Handbook for Systematic Reviews of Interventions version 6.2 (updated February 2021). Cochrane, 2021. Available from www.training.cochrane.org/handbook. https://training.cochrane.org/handbook/current

[^PRISMA]: Page M J, McKenzie J E, Bossuyt P M, Boutron I, Hoffmann T C, Mulrow C D et al. The PRISMA 2020 statement: an updated guideline for reporting systematic reviews BMJ 2021; 372 :n71 doi:10.1136/bmj.n71 http://www.prisma-statement.org/

[^Schöpfel]: Schöpfel, Joachim, and Behrooz Rasuli. 2018. “Are Electronic Theses and Dissertations (Still) Grey Literature in the Digital Age? A FAIR Debate.” The Electronic Library 36 (2): 208–19.

[^Schwarzer]: Balduzzi S, Rücker G, Schwarzer G (2019), How to perform a meta-analysis with R: a practical tutorial, Evidence-Based
  Mental Health; 22: 153-160.

[^Fleiss]: Fleiss JL. The statistical basis of meta-analysis. Stat Methods Med Res. 1993;2(2):121-145. doi:10.1177/096228029300200202